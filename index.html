<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Interactive Web Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #111;
      color: #f5f5f5;
      display: flex;
      min-height: 100vh;
      justify-content: center;
      align-items: center;
    }

    .app-container {
      width: 100%;
      max-width: 900px;
      padding: 20px;
      box-sizing: border-box;
    }

    .step { display: none; }
    .step.active { display: block; }

    /* 视频 */
    .video-wrapper {
      position: relative;
      padding-bottom: 56.25%;
      height: 0;
      overflow: hidden;
      border-radius: 12px;
      border: 1px solid #333;
    }

    .video-wrapper iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    /* 按钮 */
    .btn {
      display: inline-block;
      margin-top: 16px;
      padding: 10px 20px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: #f5f5f5;
      color: #111;
      font-size: 14px;
      font-weight: 600;
    }
    .btn[disabled] {
      opacity: 0.4;
      cursor: not-allowed;
    }

    /* quiz */
    .quiz-option {
      margin: 6px 0;
      display: block;
    }

    /* 卡片外观 */
    .quiz-card {
      background: #181818;
      border-radius: 16px;
      padding: 20px 22px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.45);
      max-width: 620px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    /* 滑动效果 */
    .slide-in-right {
      animation: slideInRight 0.35s ease-out forwards;
    }
    .slide-out-left {
      animation: slideOutLeft 0.35s ease-in forwards;
    }

    @keyframes slideInRight {
      from { opacity:0; transform: translateX(40px); }
      to   { opacity:1; transform: translateX(0); }
    }
    @keyframes slideOutLeft {
      from { opacity:1; transform: translateX(0); }
      to   { opacity:0; transform: translateX(-40px); }
    }

    /* 错误抖动 */
    .quiz-card.shake {
      animation: shake 0.4s ease;
    }
    @keyframes shake {
      0%{transform:translateX(0);}
      20%{transform:translateX(-6px);}
      40%{transform:translateX(6px);}
      60%{transform:translateX(-4px);}
      80%{transform:translateX(4px);}
      100%{transform:translateX(0);}
    }

    /* hotspot 区域（完全隐形） */
    .hotspot {
      position: absolute;
      border-radius: 999px;
      background: transparent;
      border: none;
      cursor: pointer;
    }

    /* 放大镜层 */
    #magnifier {
      position: absolute;
      width: 140px;
      height: 140px;
      border-radius: 50%;
      pointer-events: none;
      border: 2px solid #fff;
      box-shadow: 0 0 15px rgba(0,0,0,0.6);
      display: none;
      background-repeat: no-repeat;
      overflow: hidden;
      z-index: 5;
    }

    /* hotspot 区域布局 */
    .image-hotspot-container {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      margin-top: 16px;
    }

    .image-wrapper {
      position: relative;
      flex: 1 1 300px;
      max-width: 500px;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid #333;
    }

    .image-wrapper img {
      width: 100%;
      height: auto;
      display: block;
    }

    /* hotspot 右侧信息区 */
    .hotspot-info {
      flex: 1 1 200px;
      min-width: 220px;
      padding: 12px 16px;
      border-radius: 12px;
      border: 1px solid #333;
      background: #181818;
      font-size: 14px;
      line-height: 1.5;
    }

    .hotspot-info-title {
      font-weight: 600;
      margin-bottom: 6px;
      font-size: 15px;
    }

    .step-indicator {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #aaa;
      margin-bottom: 8px;
    }
  </style>
</head>

<body>
<div class="app-container">

  <!-- Step 1 -->
  <section id="step1" class="step active">
    <div class="step-indicator">Step 1 / 4</div>
    <h2>Video 1</h2>
    <p>Please watch the video.</p>

    <div class="video-wrapper">
      <div id="player1"></div>
    </div>
  </section>

  <!-- Step 2：两题 Quiz 卡片 -->
  <section id="step2" class="step">
    <div class="step-indicator">Step 2 / 4</div>
    <h2>Quiz</h2>

    <!-- Q1 -->
    <div id="cardQ1" class="quiz-card">
      <h3>Where are the fire extinguishers?</h3>

      <label class="quiz-option"><input type="radio" name="quiz1" value="A"> A. Catering stalls</label>
      <label class="quiz-option"><input type="radio" name="quiz1" value="B"> B. Info tent</label>
      <label class="quiz-option"><input type="radio" name="quiz1" value="C"> C. Market stalls</label>

      <button class="btn" id="checkQ1">Check Answer</button>
      <div class="message" id="msgQ1"></div>
    </div>

    <!-- Q2 -->
    <div id="cardQ2" class="quiz-card" style="display:none; margin-top:30px;">
      <h3>Which one is needed?</h3>

      <label class="quiz-option"><input type="radio" name="quiz2" value="A"> Water</label>
      <label class="quiz-option"><input type="radio" name="quiz2" value="B"> CO₂</label>
      <label class="quiz-option"><input type="radio" name="quiz2" value="C"> Foam</label>

      <button class="btn" id="checkQ2">Check Answer</button>
      <button class="btn" id="quizNextBtn" disabled>Next ▶</button>
      <div class="message" id="msgQ2"></div>
    </div>
  </section>

  <!-- Step 3 -->
  <section id="step3" class="step">
    <div class="step-indicator">Step 3 / 4</div>
    <h2>Video 2</h2>
    <div class="video-wrapper"><div id="player2"></div></div>
  </section>

  <!-- Step 4 -->
  <section id="step4" class="step">
    <div class="step-indicator">Step 4 / 4</div>
    <h2>Interactive Image</h2>

    <div class="image-hotspot-container">
      <div class="image-wrapper">
        <img src="market-scene.png" alt="Scene">

        <div class="hotspot" data-title="Info tent staff"
             data-description="The info tent staff help visitors with directions, safety information and emergency procedures."
             style="top: 20%; left: 15%; width: 20%; height: 30%;"></div>

        <div class="hotspot" data-title="Market stall vendor"
             data-description="The market stall vendor sells fresh produce."
             style="top: 18%; left: 60%; width: 20%; height: 28%;"></div>

        <div class="hotspot" data-title="Catering stall worker"
             data-description="Catering stalls involve cooking and open flames."
             style="top: 59%; left: 73%; width: 11%; height: 28%;"></div>

        <div class="hotspot" data-title="Water bottle"
             data-description="Staying hydrated is important."
             style="top: 48%; left: 45%; width: 10%; height: 28%;"></div>

        <div class="hotspot" data-title="Fire extinguisher"
             data-description="Every catering stall should have a fire extinguisher."
             style="top: 58%; left: 61%; width: 5%; height: 26%;"></div>

        <!-- 放大镜 -->
        <div id="magnifier"></div>
      </div>

      <div class="hotspot-info" id="hotspotInfo">
        <div class="hotspot-info-title">Hint</div>
        Click on the hotspots.
      </div>
    </div>
  </section>

</div>

<!-- YouTube API -->
<script src="https://www.youtube.com/iframe_api"></script>

<script>
let player1, player2;

// YouTube 视频 ID
const VIDEO_1_ID = "_ui398aLpIA";
const VIDEO_2_ID = "TAoYnAJLXoQ";

function showStep(num){
  document.querySelectorAll(".step").forEach((s,i)=>{
    s.classList.toggle("active", i === num-1);
  });
}

function onYouTubeIframeAPIReady(){
  player1 = new YT.Player("player1", {
    videoId: VIDEO_1_ID,
    events: { onStateChange: e => {
      if(e.data === YT.PlayerState.ENDED) showStep(2);
    }}
  });

  player2 = new YT.Player("player2", {
    videoId: VIDEO_2_ID,
    events: { onStateChange: e => {
      if(e.data === YT.PlayerState.ENDED) showStep(4);
    }}
  });
}

/* -------------------------
    多题 Quiz：滑动 + 抖动
--------------------------*/
function shake(card){
  card.classList.remove("shake");
  void card.offsetWidth;
  card.classList.add("shake");
}

const cardQ1 = document.getElementById("cardQ1");
const cardQ2 = document.getElementById("cardQ2");

document.getElementById("checkQ1").onclick = ()=>{
  const s = document.querySelector('input[name="quiz1"]:checked');
  const msg = document.getElementById("msgQ1");

  if(!s){
    msg.textContent = "Please select an option.";
    msg.className = "message wrong";
    shake(cardQ1);
    return;
  }

  if(s.value==="A"){
    msg.textContent = "Correct! Next question...";
    msg.className = "message correct";

    cardQ1.classList.add("slide-out-left");
    setTimeout(()=>{
      cardQ1.style.display="none";
      cardQ2.style.display="block";
      cardQ2.classList.add("slide-in-right");
    },300);

  } else {
    msg.textContent = "Wrong. Try again!";
    msg.className = "message wrong";
    shake(cardQ1);
  }
};

document.getElementById("checkQ2").onclick = ()=>{
  const s = document.querySelector('input[name="quiz2"]:checked');
  const msg = document.getElementById("msgQ2");
  const next = document.getElementById("quizNextBtn");

  if(!s){
    msg.textContent="Please select an option.";
    msg.className="message wrong";
    shake(cardQ2);
    return;
  }

  if(s.value==="A"){
    msg.textContent="Correct! Click Next.";
    msg.className="message correct";
    next.disabled=false;
  } else {
    msg.textContent="Wrong. Try again!";
    msg.className="message wrong";
    next.disabled=true;
    shake(cardQ2);
  }
};

document.getElementById("quizNextBtn").onclick = ()=>{
  showStep(3);
  player2.playVideo();
};

/* -------------------------
   放大镜 + hotspot
--------------------------*/
const image = document.querySelector("#step4 img");
const magnifier = document.getElementById("magnifier");
const hotspotInfo = document.getElementById("hotspotInfo");

document.addEventListener("click", ev=>{
  const hs = ev.target.closest(".hotspot");
  if(!hs) return;

  // 更新右侧信息
  hotspotInfo.innerHTML = `
    <div class="hotspot-info-title">${hs.dataset.title}</div>
    ${hs.dataset.description}
  `;

  const rect = image.getBoundingClientRect();
  const zoom = 2.2;
  const lens = 140;

  const x = ev.clientX - rect.left;
  const y = ev.clientY - rect.top;

  magnifier.style.display="block";
  magnifier.style.left = (x - lens/2)+"px";
  magnifier.style.top  = (y - lens/2)+"px";

  magnifier.style.backgroundImage = `url(${image.src})`;
  magnifier.style.backgroundSize = `${rect.width*zoom}px ${rect.height*zoom}px`;

  magnifier.style.backgroundPosition =
    `${-(x*zoom - lens/2)}px ${-(y*zoom - lens/2)}px`;
});
</script>

</body>
</html>
